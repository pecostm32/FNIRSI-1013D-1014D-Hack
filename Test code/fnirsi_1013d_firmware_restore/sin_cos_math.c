//----------------------------------------------------------------------------------------------------------------------------------

#include "types.h"

//----------------------------------------------------------------------------------------------------------------------------------

const uint16 qsintable[] =
{
      0,    29,    57,    86,   114,   143,   172,   200,   229,   257,   286,   315,   343,   372,   400,   429,   457,   486,
    515,   543,   572,   600,   629,   658,   686,   715,   743,   772,   800,   829,   857,   886,   915,   943,   972,  1000,
   1029,  1057,  1086,  1114,  1143,  1171,  1200,  1228,  1257,  1285,  1314,  1342,  1371,  1399,  1428,  1456,  1485,  1513,
   1542,  1570,  1599,  1627,  1656,  1684,  1713,  1741,  1769,  1798,  1826,  1855,  1883,  1912,  1940,  1968,  1997,  2025,
   2053,  2082,  2110,  2139,  2167,  2195,  2224,  2252,  2280,  2309,  2337,  2365,  2393,  2422,  2450,  2478,  2507,  2535,
   2563,  2591,  2619,  2648,  2676,  2704,  2732,  2761,  2789,  2817,  2845,  2873,  2901,  2929,  2958,  2986,  3014,  3042,
   3070,  3098,  3126,  3154,  3182,  3210,  3238,  3266,  3294,  3322,  3350,  3378,  3406,  3434,  3462,  3490,  3518,  3546,
   3574,  3602,  3630,  3658,  3686,  3713,  3741,  3769,  3797,  3825,  3853,  3880,  3908,  3936,  3964,  3991,  4019,  4047,
   4075,  4102,  4130,  4158,  4185,  4213,  4240,  4268,  4296,  4323,  4351,  4378,  4406,  4434,  4461,  4489,  4516,  4544,
   4571,  4598,  4626,  4653,  4681,  4708,  4735,  4763,  4790,  4818,  4845,  4872,  4899,  4927,  4954,  4981,  5009,  5036,
   5063,  5090,  5117,  5144,  5172,  5199,  5226,  5253,  5280,  5307,  5334,  5361,  5388,  5415,  5442,  5469,  5496,  5523,
   5550,  5577,  5604,  5631,  5657,  5684,  5711,  5738,  5765,  5791,  5818,  5845,  5872,  5898,  5925,  5952,  5978,  6005,
   6031,  6058,  6084,  6111,  6138,  6164,  6191,  6217,  6243,  6270,  6296,  6323,  6349,  6375,  6402,  6428,  6454,  6481,
   6507,  6533,  6559,  6586,  6612,  6638,  6664,  6690,  6716,  6742,  6768,  6794,  6820,  6846,  6872,  6898,  6924,  6950,
   6976,  7002,  7028,  7053,  7079,  7105,  7131,  7157,  7182,  7208,  7234,  7259,  7285,  7311,  7336,  7362,  7387,  7413,
   7438,  7464,  7489,  7515,  7540,  7565,  7591,  7616,  7641,  7667,  7692,  7717,  7742,  7767,  7793,  7818,  7843,  7868,
   7893,  7918,  7943,  7968,  7993,  8018,  8043,  8068,  8093,  8118,  8142,  8167,  8192,  8217,  8241,  8266,  8291,  8316,
   8340,  8365,  8389,  8414,  8438,  8463,  8487,  8512,  8536,  8561,  8585,  8609,  8634,  8658,  8682,  8706,  8731,  8755,
   8779,  8803,  8827,  8851,  8875,  8899,  8923,  8947,  8971,  8995,  9019,  9043,  9067,  9091,  9114,  9138,  9162,  9186,
   9209,  9233,  9256,  9280,  9304,  9327,  9351,  9374,  9397,  9421,  9444,  9468,  9491,  9514,  9538,  9561,  9584,  9607,
   9630,  9653,  9676,  9700,  9723,  9746,  9769,  9791,  9814,  9837,  9860,  9883,  9906,  9929,  9951,  9974,  9997, 10019,
  10042, 10064, 10087, 10110, 10132, 10154, 10177, 10199, 10222, 10244, 10266, 10289, 10311, 10333, 10355, 10377, 10399, 10422,
  10444, 10466, 10488, 10510, 10531, 10553, 10575, 10597, 10619, 10641, 10662, 10684, 10706, 10727, 10749, 10770, 10792, 10813,
  10835, 10856, 10878, 10899, 10920, 10942, 10963, 10984, 11005, 11027, 11048, 11069, 11090, 11111, 11132, 11153, 11174, 11195,
  11216, 11236, 11257, 11278, 11299, 11319, 11340, 11361, 11381, 11402, 11422, 11443, 11463, 11484, 11504, 11524, 11545, 11565,
  11585, 11605, 11626, 11646, 11666, 11686, 11706, 11726, 11746, 11766, 11786, 11806, 11825, 11845, 11865, 11885, 11904, 11924,
  11943, 11963, 11982, 12002, 12021, 12041, 12060, 12080, 12099, 12118, 12137, 12157, 12176, 12195, 12214, 12233, 12252, 12271,
  12290, 12309, 12328, 12346, 12365, 12384, 12403, 12421, 12440, 12458, 12477, 12496, 12514, 12532, 12551, 12569, 12588, 12606,
  12624, 12642, 12660, 12679, 12697, 12715, 12733, 12751, 12769, 12787, 12804, 12822, 12840, 12858, 12875, 12893, 12911, 12928,
  12946, 12963, 12981, 12998, 13016, 13033, 13050, 13068, 13085, 13102, 13119, 13136, 13153, 13170, 13187, 13204, 13221, 13238,
  13255, 13272, 13288, 13305, 13322, 13338, 13355, 13372, 13388, 13405, 13421, 13437, 13454, 13470, 13486, 13502, 13519, 13535,
  13551, 13567, 13583, 13599, 13615, 13631, 13647, 13662, 13678, 13694, 13710, 13725, 13741, 13756, 13772, 13787, 13803, 13818,
  13833, 13849, 13864, 13879, 13894, 13910, 13925, 13940, 13955, 13970, 13985, 13999, 14014, 14029, 14044, 14059, 14073, 14088,
  14102, 14117, 14131, 14146, 14160, 14175, 14189, 14203, 14217, 14232, 14246, 14260, 14274, 14288, 14302, 14316, 14330, 14344,
  14357, 14371, 14385, 14399, 14412, 14426, 14439, 14453, 14466, 14480, 14493, 14506, 14520, 14533, 14546, 14559, 14572, 14585,
  14598, 14611, 14624, 14637, 14650, 14663, 14675, 14688, 14701, 14713, 14726, 14738, 14751, 14763, 14776, 14788, 14800, 14812,
  14825, 14837, 14849, 14861, 14873, 14885, 14897, 14909, 14921, 14932, 14944, 14956, 14968, 14979, 14991, 15002, 15014, 15025,
  15036, 15048, 15059, 15070, 15082, 15093, 15104, 15115, 15126, 15137, 15148, 15159, 15169, 15180, 15191, 15202, 15212, 15223,
  15233, 15244, 15254, 15265, 15275, 15286, 15296, 15306, 15316, 15326, 15336, 15346, 15356, 15366, 15376, 15386, 15396, 15406,
  15415, 15425, 15435, 15444, 15454, 15463, 15473, 15482, 15491, 15501, 15510, 15519, 15528, 15537, 15546, 15555, 15564, 15573,
  15582, 15591, 15600, 15608, 15617, 15626, 15634, 15643, 15651, 15660, 15668, 15676, 15685, 15693, 15701, 15709, 15717, 15725,
  15733, 15741, 15749, 15757, 15765, 15773, 15780, 15788, 15796, 15803, 15811, 15818, 15826, 15833, 15840, 15848, 15855, 15862,
  15869, 15876, 15883, 15890, 15897, 15904, 15911, 15918, 15925, 15931, 15938, 15945, 15951, 15958, 15964, 15970, 15977, 15983,
  15989, 15996, 16002, 16008, 16014, 16020, 16026, 16032, 16038, 16044, 16049, 16055, 16061, 16066, 16072, 16077, 16083, 16088,
  16094, 16099, 16104, 16110, 16115, 16120, 16125, 16130, 16135, 16140, 16145, 16150, 16155, 16159, 16164, 16169, 16173, 16178,
  16182, 16187, 16191, 16195, 16200, 16204, 16208, 16212, 16216, 16221, 16225, 16229, 16232, 16236, 16240, 16244, 16248, 16251,
  16255, 16258, 16262, 16265, 16269, 16272, 16275, 16279, 16282, 16285, 16288, 16291, 16294, 16297, 16300, 16303, 16306, 16309,
  16311, 16314, 16317, 16319, 16322, 16324, 16327, 16329, 16331, 16333, 16336, 16338, 16340, 16342, 16344, 16346, 16348, 16350,
  16352, 16353, 16355, 16357, 16358, 16360, 16362, 16363, 16364, 16366, 16367, 16368, 16370, 16371, 16372, 16373, 16374, 16375,
  16376, 16377, 16378, 16378, 16379, 16380, 16380, 16381, 16382, 16382, 16382, 16383, 16383, 16383, 16384, 16384, 16384, 16384,
  16384
};

//----------------------------------------------------------------------------------------------------------------------------------
//The quarter sine table holds values for 0.1 degree steps, so input can range from 0 to 3600
//for a full circle. No checks are performed to keep performance up
//The position is either increased or decreased based on the quadrant the angle is in
int16 getypos(uint16 degree, uint16 position, uint16 radius)
{
  uint16 quadrant = (degree / 900) % 4;
  uint16 index = degree % 900;
  uint16 sinval = 0;

  //Get the value from the sine table based on which quadrant it is in
  switch(quadrant)
  {
    case 0:
    case 2:
      //For up ramping table starts from the beginning
      sinval = qsintable[index];
      break;

    case 1:
    case 3:
      //For down ramping table starts from the end
      sinval = qsintable[900 - index];
      break;
  }
  
  //Calculate the absolute offset
  sinval = (sinval * radius) >> 14;
  
  //Check if quadrant is in the negative section
  if(quadrant <= 1)
    return(position + sinval);
  else
    return(position - sinval);
}

//----------------------------------------------------------------------------------------------------------------------------------

int16 getxpos(uint16 degree, uint16 position, uint16 radius)
{
  uint16 quadrant;
  uint16 index;
  uint16 cosval = 0;

  //90 degree phase difference for cosine
  degree += 900;
  quadrant = (degree / 900) % 4;
  index = degree % 900;
  
  //Get the value from the sine table based on which quadrant it is in
  switch(quadrant)
  {
    case 0:
    case 2:
      //For up ramping table starts from the beginning
      cosval = qsintable[index];
      break;

    case 1:
    case 3:
      //For down ramping table starts from the end
      cosval = qsintable[900 - index];
      break;
  }
  
  //Calculate the absolute offset
  cosval = (cosval * radius) >> 14;
  
  //Check if quadrant is in the negative section
  if(quadrant <= 1)
    return(position + cosval);
  else
    return(position - cosval);
}

//----------------------------------------------------------------------------------------------------------------------------------
